<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>星盤計算器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 720px;
      margin: 20px auto;
      padding: 20px;
      background: #f9f9f9;
      line-height: 1.6;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      margin-bottom: 10px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    pre {
      background: #fff;
      padding: 12px;
      border: 1px solid #ddd;
      overflow-x: auto;
    }
    h2 {
      background-color: #e0e0e0;
      padding: 6px;
    }
  </style>
</head>
<body>
  <h1>星盤分析輸入</h1>
  <form id="astroForm">
    <label>出生日期</label>
    <input type="date" id="birth_date" value="1992-02-05" required>

    <label>出生時間</label>
    <input type="time" id="birth_time" value="01:53" required>

    <label>預設地點（台灣）</label>
    <select id="locationSelect">
      <option value="25.033964,121.564468">台北</option>
      <option value="24.147736,120.673648">台中</option>
      <option value="22.627278,120.301435">高雄</option>
      <option value="23.69781,120.960515">其他（手動輸入）</option>
    </select>

    <label>緯度</label>
    <input type="number" step="0.000001" id="latitude" value="25.033964" required>

    <label>經度</label>
    <input type="number" step="0.000001" id="longitude" value="121.564468" required>

    <button type="submit">計算星盤</button>
  </form>

  <div id="output"></div>

  <script>
    const locationSelect = document.getElementById("locationSelect");
    locationSelect.addEventListener("change", function () {
      const [lat, lon] = this.value.split(',');
      document.getElementById("latitude").value = lat;
      document.getElementById("longitude").value = lon;
    });

    document.getElementById("astroForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const body = {
        birth_date: document.getElementById("birth_date").value,
        birth_time: document.getElementById("birth_time").value,
        latitude: document.getElementById("latitude").value,
        longitude: document.getElementById("longitude").value
      };
      const res = await fetch("/api/astro", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      const data = await res.json();

      const output = document.getElementById("output");
      output.innerHTML = `
        <h2>Asc / MC</h2>
        上升星座度數: ${data.ascendant}<br>
        天頂MC度數: ${data.midheaven}<br>

        <h2>行星與特殊點</h2>
        <pre>${JSON.stringify(data.planets, null, 2)}</pre>

        <h2>相位表</h2>
        <pre>${JSON.stringify(data.aspects, null, 2)}</pre>

        <h2>宮主星分配</h2>
        <pre>${JSON.stringify(data.house_rulers, null, 2)}</pre>
      `;
    });
  </script>
</body>
</html>
